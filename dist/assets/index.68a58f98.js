import{f as e}from"./vendor.8e5174b7.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const a=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,s)=>{const c=new URL(e,a);if(self[t].moduleMap[c])return o(self[t].moduleMap[c]);const r=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),n(d)},onload(){o(self[t].moduleMap[c]),n(d)}});document.head.appendChild(d)})),self[t].moduleMap={}}}("/assets/");const t={apiKey:"AIzaSyCibDz4E5DNe2OeGGs6JGi4cu_-AG_qC2s",authDomain:"tesis-ea84f.firebaseapp.com",projectId:"tesis-ea84f",storageBucket:"tesis-ea84f.appspot.com",messagingSenderId:"649216652710",appId:"1:649216652710:web:9db86a29c798f557658b67"};e.apps.length||e.initializeApp(t);const o=e.firestore(),a=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let n=null,s=null;const c=document.getElementById("webcamButton"),r=document.getElementById("webcamVideo"),d=document.getElementById("callButton"),i=document.getElementById("callInput"),l=document.getElementById("answerButton"),m=document.getElementById("remoteVideo"),u=document.getElementById("hangupButton"),p=document.getElementById("messageForm"),f=document.getElementById("messageInput"),g=document.getElementById("messageArea");function h(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let o=0;o<10;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}let y=h();c.onclick=async()=>{y=i.value||y||h(),o.collection("calls").doc(y),o.collection("messages").doc(y).collection("roomMessages");try{n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),s=new MediaStream,n.getTracks().forEach((e=>{a.addTrack(e,n),"audio"===e.kind&&(e.enabled=!1)})),a.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{s.addTrack(e)}))},r.srcObject=n,m.srcObject=s,d.disabled=!1,l.disabled=!1,c.disabled=!0,async function(t){const a=new webkitSpeechRecognition;a.lang="es-ES",a.continuous=!0,a.onresult=async t=>{const a=t.results[t.results.length-1][0].transcript;try{!async function(t){try{const a={text:t,timestamp:e.firestore.FieldValue.serverTimestamp(),sender:"user_id_here"};await o.collection("messages").doc(y).collection("roomMessages").add(a)}catch(a){console.error("Error al enviar el mensaje:",a)}}(await async function(e,t){const o="https://translation.googleapis.com/language/translate/v2?key=AIzaSyAnzOQD0CKfrWmvdmK1v-Za_FQpyBWVOGg",a={q:e,target:t};try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok){const t=await e.json();return t.data.translations[0].translatedText}throw new Error("Error en la solicitud de traducci칩n")}catch(n){throw console.error("Error al traducir texto:",n),n}}(a,"en"))}catch(n){console.error("Error al transcribir y traducir audio:",n)}},a.onerror=e=>{console.error("Error en la transcripci칩n:",e.error)},a.start()}()}catch(t){console.error("Error al obtener la transmisi칩n de la c치mara:",t)}},d.onclick=async()=>{const e=i.value;if(y=e||y||h(),!y)return void console.error("No se ha establecido el roomId.");const t=o.collection("calls").doc(y),n=t.collection("answerCandidates"),s=t.collection("offerCandidates");i.value=y,a.onicecandidate=e=>{e.candidate&&s.add(e.candidate.toJSON())};const c=await a.createOffer();await a.setLocalDescription(c);const r={sdp:c.sdp,type:c.type};await t.set({offer:r}),t.onSnapshot((e=>{const t=e.data();if(!a.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);a.setRemoteDescription(e)}})),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());a.addIceCandidate(t)}}))})),u.disabled=!1;o.collection("s").doc(e).collection("roomMessages").orderBy("timestamp").onSnapshot((e=>{g.innerHTML="",e.forEach((e=>{const t=e.data(),o=document.createElement("div");o.textContent=`${t.sender}: ${t.text}`,g.appendChild(o)}))}))},l.onclick=async()=>{const e=i.value;if(y=e||y||h(),!y)return void console.error("No se ha establecido el roomId.");const t=o.collection("calls").doc(e),n=t.collection("answerCandidates"),s=t.collection("offerCandidates");a.onicecandidate=e=>{e.candidate&&n.add(e.candidate.toJSON())};const c=(await t.get()).data().offer;await a.setRemoteDescription(new RTCSessionDescription(c));const r=await a.createAnswer();await a.setLocalDescription(r);const d={type:r.type,sdp:r.sdp};await t.update({answer:d}),s.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){let t=e.doc.data();a.addIceCandidate(new RTCIceCandidate(t))}}))}));o.collection("messages").doc(e).collection("roomMessages").orderBy("timestamp").onSnapshot((e=>{g.innerHTML="",e.forEach((e=>{const t=e.data(),o=document.createElement("div");o.textContent=`${t.sender}: ${t.text}`,g.appendChild(o)}))}))},p.addEventListener("submit",(async t=>{t.preventDefault();const a={text:f.value,timestamp:e.firestore.FieldValue.serverTimestamp(),sender:"user_id_here"};await o.collection("messages").doc(y).collection("roomMessages").add(a),f.value=""})),o.collection("messages").doc(y).collection("roomMessages").orderBy("timestamp").onSnapshot((e=>{g.innerHTML="",e.forEach((e=>{const t=e.data(),o=document.createElement("div");o.textContent=`${t.sender}: ${t.text}`,g.appendChild(o)}))}));
